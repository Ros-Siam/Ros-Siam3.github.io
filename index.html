<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ros Siam Queue</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: 'Kanit', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #fff5e6;
      }

      header {
        background-color: #a52a2a;
        color: white;
        padding: 10px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
      }

      header img {
        height: 50px;
      }

      header h1 {
        margin: 0;
        font-size: 1.5rem;
      }

      .input-container {
        position: absolute;
        top: 10px;
        right: 20px;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
      }

      .input-container label {
        font-size: 0.8rem;
        margin-bottom: 3px;
      }

      #orderInput {
        font-size: 1rem;
        padding: 4px 8px;
        width: 80px;
        border: 2px solid white;
        border-radius: 8px;
        outline: none;
        font-family: 'Kanit', sans-serif;
        color: #333;
      }

      main {
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      section {
        background-color: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      h2 {
        margin-top: 0;
        color: #a52a2a;
      }

      .orderList {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        font-size: 1.5rem;
      }

      .orderItem {
        background-color: #ffe6cc;
        padding: 10px 15px;
        border-radius: 8px;
        min-width: 60px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <header>
      <img src="https://drive.google.com/thumbnail?id=1fjf65qn08ihSykXBZOOFQJJzFevHGjMh" alt="logo" />
      <h1>ขาหมู รสสยาม</h1>
      <div class="input-container">
        <label for="orderInput">order</label>
        <input id="orderInput" type="text" autocomplete="off" maxlength="10" />
      </div>
    </header>

    <main>
      <section>
        <h2>กำลังเตรียมอาหาร</h2>
        <div id="preparingList" class="orderList"></div>
      </section>
      <section>
        <h2>พร้อมส่ง</h2>
        <div id="readyList" class="orderList"></div>
      </section>
    </main>

    <!-- Firebase SDKs -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import {
        getFirestore,
        collection,
        onSnapshot,
        doc,
        setDoc,
        deleteDoc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCFisUUeCGCvL3_3XK3t_OStyO3f24A238",
        authDomain: "ros-siam-queue-management.firebaseapp.com",
        projectId: "ros-siam-queue-management",
        storageBucket: "ros-siam-queue-management.appspot.com",
        messagingSenderId: "790945202211",
        appId: "1:790945202211:web:0d6ea426bb3a1b3b843196",
        measurementId: "G-3H73HZB651",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const orderInput = document.getElementById("orderInput");
      const preparingList = document.getElementById("preparingList");
      const readyList = document.getElementById("readyList");

      orderInput.addEventListener("keypress", async (e) => {
        if (e.key === "Enter") {
          const value = orderInput.value.trim();
          if (!value) return;
          orderInput.value = "";

          const prepDoc = doc(db, "preparing", value);
          const readyDoc = doc(db, "ready", value);

          const prepSnap = await getDoc(prepDoc);
          const readySnap = await getDoc(readyDoc);

          if (prepSnap.exists()) {
            await deleteDoc(prepDoc);
            await setDoc(readyDoc, { timestamp: Date.now() });
          } else if (readySnap.exists()) {
            await deleteDoc(readyDoc);
          } else {
            await setDoc(prepDoc, { timestamp: Date.now() });
          }
        }
      });

      function renderList(snapshot, container) {
        container.innerHTML = "";
        snapshot.forEach((doc) => {
          const div = document.createElement("div");
          div.className = "orderItem";
          div.textContent = doc.id;
          container.appendChild(div);
        });
      }

      onSnapshot(collection(db, "preparing"), (snapshot) =>
        renderList(snapshot, preparingList)
      );

      onSnapshot(collection(db, "ready"), (snapshot) =>
        renderList(snapshot, readyList)
      );
    </script>
  </body>
</html>
